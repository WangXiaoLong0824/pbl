<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <title>会员列表</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <link href="../web/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../web/css/style.css"/>
    <link rel="stylesheet" href="../web/css/ace.min.css" />
    <link rel="stylesheet" href="../web/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../web/css/zTreeStyle.css" type="text/css">
    <link href="../web/css/icheck.css" rel="stylesheet" type="text/css" />
    <!--[if IE 7]>
    <link rel="stylesheet" href="../web/css/font-awesome-ie7.min.css" />
    <![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="../web/css/ace-ie.min.css" />
    <![endif]-->
    <script type="text/javascript" src="../web/js/vue.min.js"></script>
    <script src="../web/js/jquery-1.9.1.min.js"></script>
    <script src="../web/js/bootstrap.min.js"></script>
    <script src="../web/js/typeahead-bs2.min.js"></script>
    <!-- page specific plugin scripts -->
    <script src="../web/js/jquery.dataTables.min.js"></script>
    <script src="../web/js/jquery.dataTables.bootstrap.js"></script>
    <script type="text/javascript" src="../web/js/H-ui.js"></script>
    <script type="text/javascript" src="../web/js/H-ui.admin.js"></script>
    <script src="../web/js/layer.js" type="text/javascript" ></script>
    <script src="../web/js/laydate.js" type="text/javascript"></script>
    <script type="text/javascript" src="../web/js/jquery.ztree.all-3.5.min.js"></script>
    <script src="../web/js/lrtk.js" type="text/javascript" ></script>

    <link rel="stylesheet" th:href="@{/webjars/bootstrap/3.3.7/dist/css/bootstrap.css}">
    <script th:src="@{/webjars/jquery/3.5.1/dist/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/3.3.7/dist/js/bootstrap.min.js}"></script>

    <script type="text/javascript" src="../web/js/bootstrap-paginator.js"></script>
    <!--<link rel="stylesheet" th:href="@{/webjars/bootstrap/3.3.7/dist/css/bootstrap.css}">
    <script th:src="@{/webjars/jquery/3.5.1/dist/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/3.3.7/dist/js/bootstrap.min.js}"></script>
    <script type="text/javascript" src="../web/js/vue.min.js"></script>
    <script type="text/javascript" src="../bootstrap/bootstrap-paginator.js"></script>-->
</head>
<body>
<div class="breadcrumb">
    <a href="http://localhost:8080/shopxxb2b2c/admin/common/index">首页</a> » 会员列表
</div>
<form id="listForm" action="http://localhost:8080/shopxxb2b2c/admin/store_rank/list" method="get">
    <div class="pull-left">
        <div class="form-group form-inline">
            <div class="btn-group">
                <button type="button" shiro:hasPermission="huiYuan:addHY" class="btn btn-default" title="新建" data-toggle="modal" data-target="#editModal" v-on:click="storeCategory = {}"><i class="fa fa-file-o"></i> 新建</button>
               <!-- <button type="button" class="btn btn-default" title="删除" onclick="deleteStoreCategory()"><i class="fa fa-trash-o"></i> 删除</button>-->
                <button type="button" class="btn btn-default" title="刷新" onclick="window.location.reload();"><i class="fa fa-refresh"></i> 刷新</button>
            </div>
        </div>
    </div>
    <div id="app" class="container">
        <h1>会员列表</h1>
        <form action="" id="list_form">
            <div class="form-group">
                <label for="name" class="col-sm-1 control-label">名称：</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="name" v-model="userName1" placeholder="请输入名字">
                </div>
            </div>
            <button type="button" class="btn btn-default" onclick="searchStoreCategoryList()">搜索</button>
        </form>
        <br>
        <table class="table table-bordered">
            <tr>
                <th class="" style="padding-right:0px">
                    <input id="selall" type="checkbox" class="icheckbox_square-blue">
                </th>
                <th>ID</th>
                <th>用户名</th>
                <th>性别</th>
                <th>手机</th>
                <th>邮箱</th>
                <th>地区</th>
                <th>加入时间</th>
                <th>等级</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
            <tr v-for="storeCategory in storeCategoryList">
                <td>
                    <input  type="checkbox" v-on:click="updateSelection($event, storeCategory.userId)">
                </td>
                <td>{{storeCategory.userId}}</td>
                <td>{{storeCategory.userName}}</td>
                <td>{{storeCategory.userSex==1?"男":"女"}}</td>
                <td>{{storeCategory.userPhone}}</td>
                <td>{{storeCategory.userEmail}}</td>

                <td>{{storeCategory.shengName}}{{storeCategory.shiName}}{{storeCategory.xianName}}</td>

                <td>{{storeCategory.createTime}}</td>
                <td>{{storeCategory.levelName}}</td>
                <td>{{storeCategory.userStatus==1?"启用":"未启用"}}</td>

                <td>
                    <button type="button" shiro:hasPermission="huiYuan:findHy" class="btn bg-olive btn-xs" data-toggle="modal" data-target="#editModal" v-on:click="findOne(storeCategory.userId)" >修改</button>
                    <button type="button" shiro:hasPermission="huiYuan:deleteHY" class="btn bg-olive btn-xs"  v-on:click="deleteStoreCategory(storeCategory.userId)" >删除</button>
                </td>
            </tr>
        </table>
        <div id="example" style="text-align: right"> <ul id="pageLimit"></ul> </div>
    </div>
    <input type="hidden" id="pageSize" name="pageSize" value="20">
    <input type="hidden" id="searchProperty" name="searchProperty" value="name">
    <input type="hidden" id="orderProperty" name="orderProperty" value="">
    <input type="hidden" id="orderDirection" name="orderDirection" value="">
</form>
<!-- 编辑窗口 -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" id="ppa" style="margin-right: 2000px">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h3 id="myModalLabel">留言信息</h3>
            </div>
            <form id="userForm" method="post">
                <div class="modal-body">
                    <table class="table table-bordered table-striped"  width="300px">
                        <tr>
                            <td>编号</td>
                            <td><input id="userId" name="userId" class="form-control"  placeholder="编号" v-model="storeCategory.userId">  </td>
                        </tr>
                        <tr>
                            <td>名称</td>
                            <td><input id="userName" name="userName" class="form-control" placeholder="名称" v-model="storeCategory.userName">  </td>
                        </tr>
                        <tr>
                            <td>性别</td>
                            <td><input type="radio" name="userSex" v-model="storeCategory.userSex" value="1">男
                                <input type="radio" name="userSex" v-model="storeCategory.userSex" value="2">女</td>
                        </tr>
                        <td>手机</td>
                        <td><input id="userPhone" name="userPhone" class="form-control" placeholder="手机" v-model="storeCategory.userPhone">  </td>
                        </tr>
                        <td>邮箱</td>
                        <td><input id="userEmail" name="userEmail" class="form-control" placeholder="邮箱" v-model="storeCategory.userEmail">  </td>
                        </tr>
                        <td>加入时间</td>
                        <td><input id="createTime" name="createTime" class="form-control" placeholder="加入时间" v-model="storeCategory.createTime">  </td>
                        </tr>
                        <td>等级</td>
                        <td><input type="radio" name="levelId" v-model="storeCategory.levelId" value="1">金牌用户
                            <input type="radio" name="levelId" v-model="storeCategory.levelId" value="2">银牌用户
                            <input type="radio" name="levelId" v-model="storeCategory.levelId" value="3">普通用户</td>
                        </tr>
                        <td>积分</td>
                        <td><input id="userJiFen" name="userJiFen" class="form-control" placeholder="积分" v-model="storeCategory.userJiFen">  </td>
                        </tr>
                        <td>状态</td>
                        <td><input type="radio" name="userStatus" v-model="storeCategory.userStatus" value="1">启用
                            <input type="radio" name="userStatus" v-model="storeCategory.userStatus" value="2">未启用</td>
                        </tr>
                        <!-- <input type="hidden" v-model="storeCategory.id"> -->
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" data-dismiss="modal" aria-hidden="true" onclick="saveStoreCategory()">保存</button>
                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</button>
                </div>
            </form>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">
    var vm = new Vue({
        el: '#app',
        data: {
            storeCategoryList: "",
            totalPage:"",
            total:"",
            currPage:"",
            pageSize:"",
            userName1:""
        }
    })

    $(function() {
        searchStoreCategoryList();
    })
    function searchStoreCategoryList() {
        $.ajax({
            type:"post",
            url:"../huiYuan/findHuiYuanLevel",
            data:{"currPage":vm.currPage,"pageSize":vm.pageSize,"userName":vm.userName1},
            dataType:"json",
            success: function(result) {
                vm.storeCategoryList = result.rows;
                vm.totalPage = result.totalPage;
                vm.total = result.total;
                vm.currPage = result.currPage;
                vm.pageSize = result.pageSize;
                setPage(result.currPage,result.totalPage,result.pageSize);
            },
            error : function() {
                alert("系统错误，请联系管理员！");
            }
        })
    }
    /**
     *
     * @param pageCurrent 当前所在页
     * @param pageSum 总页数
     * @param callback 调用ajax
     */
    function setPage(pageCurrent, pageSum, pageSize) {
        $('#pageLimit').bootstrapPaginator({
            currentPage: pageCurrent,//当前的请求页面。
            totalPages: pageSum,//一共多少页。
            size:"normal",//应该是页眉的大小。
            bootstrapMajorVersion: 3,//bootstrap的版本要求。
            alignment:"right",
            numberOfPages:pageSize,//一页列出多少数据。
            itemTexts: function (type, page, current) {//如下的代码是将页眉显示的中文显示我们自定义的中文。
                switch (type) {
                    case "first": return "首页";
                    case "prev": return "上一页";
                    case "next": return "下一页";
                    case "last": return "末页";
                    case "page": return page;
                }
            },
            //当单击操作按钮的时候, 执行该函数, 调用ajax渲染页面
            onPageClicked: function (event,originalEvent,type,page) {
                // 把当前点击的页码赋值给currentPage, 调用ajax,渲染页面
                vm.currPage = page;
                searchStoreCategoryList();
                //  callback && callback()
            }
        });
    }
    vm.selectIds = [];
    //复选框选中
    function updateSelection($event, id) {
        if ($event.target.checked) {
            vm.selectIds.push(id);
        } else {
            var idx = vm.selectIds.indexOf(id);
            vm.selectIds.splice(idx, 1);//删除
        }

        console.info(vm.selectIds.toString());
    }

    //删除
    function deleteStoreCategory(userId) {
        $.ajax({
            type:'post',
            url:'../huiYuan/deleteHuiYuan',
            data:{userId: userId},
            dataType:'json',
            success:function (result) {
                alert("成功");
                searchStoreCategoryList();
                $("input[type='checkbox']").prop("checked", false);

            },
            error: function (result) {
                searchStoreCategoryList();
            }
        })
    }
    //保存
    function saveStoreCategory() {
        $.ajax({
            type:'post',
            url:'../huiYuan/addHuiYuan',
            data:$("#userForm").serialize(),
            dataType:'json',
            success: function (result) {
                searchStoreCategoryList();
            },
            error: function () {
                searchStoreCategoryList();
            }
        })
    }
    //修改回显
    function findOne(id) {
        $.ajax({
            type:'post',
            url:'../huiYuan/findHuiYuanLevelById',
            data:{userId: id},
            dataType: 'json',
            success: function (result) {

                $("#userId").val(result.userId);
                $("#userName").val(result.userName);
                $("#userEmail").val(result.userEmail);
                $("#userPhone").val(result.userPhone);
                $("#userJiFen").val(result.userJiFen);
                $("#createTime").val(result.createTime);
                $("#userStatus").attr("value",null);
                $("#userSex").attr("value",null);
                $("#levelId").attr("value",null);
                $("input[name=userStatus][value="+result.userStatus+"]").attr("checked",true);
                $("input[name=userSex][value="+result.userSex+"]").attr("checked",true);
                $("input[name=levelId][value="+result.levelId+"]").attr("checked",true);
            },
            error: function () {
                alert("系统错误，请联系管理员！");
            }
        })
    }
</script>
</html>